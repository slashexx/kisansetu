<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kisanSetu</title>
  <link rel="shortcut icon" href="./images/favicon.jpg" type="image/x-icon" />
  <link rel="stylesheet" href="farmers-page.css" />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <div class="header">
    <nav class="nav-bar">
      <a href="home-page.html">
        <img src="./images/farmer-logo.png" alt="logo" class="logo" />
      </a>
      <ul class="nav-links">
        <li><a href="home-page.html">Home</a></li>
        <li><a href="farmers-page.html" class="active">Farmers</a></li>
        <li><a href="crops-page.html">Crops</a></li>
        <li><a href="about-us-page.html">About Us</a></li>
      </ul>
      <div class="buttons">
        <a href="./signup.html"><button class="sign-up">Sign up</button></a>
        <a href="./login.html"><button class="login">Login</button></a>
      </div>
    </nav>
  </div>
  <div class="farmers-list">
    <h1>Farmers List</h1>
    <table>
      <thead>
        <tr>
          <th>Profile Picture</th>
          <th>Name</th>
          <th>State</th>
          <th>Crop Type</th>
          <th>Amount Produced</th>
          <th>Government Verified</th>
        </tr>
      </thead>
      <tbody id="farmer-table-body">
        <!-- Farmer rows will be populated here -->
      </tbody>
    </table>
  </div>
  <!-- <script type="module" src="farmers.js"></script> -->
  <script type="module">
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, query, collection, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyBNrhwRH5TeqAPyXmToaCGJ6St4g1FKOno",
      authDomain: "kisansetu-1640.firebaseapp.com",
      projectId: "kisansetu-1640",
      storageBucket: "kisansetu-1640.appspot.com",
      messagingSenderId: "763552320675",
      appId: "1:763552320675:web:93cff2382387b7b5dc4316"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();
  
    let farmers = [];
  
    async function fetchFirestoreFarmers() {
      try {
        const farmersQuery = query(collection(db, "users"), where("occupation", "==", "Farmer"));
        const querySnapshot = await getDocs(farmersQuery);
        
        if (querySnapshot.empty) {
          console.log("No matching farmers found.");
          return;
        }
  
        const firestoreFarmers = querySnapshot.docs.map(doc => ({
          farmerId: doc.id,
          ...doc.data()
        }));
  
        // Merge with existing farmers data
        farmers = [...farmers, ...firestoreFarmers];
  
        console.log(farmers);
        displayFarmers();
      } catch (error) {
        console.error("Error fetching farmers from Firestore:", error);
      }
    }
  
    function displayFarmers() {
  const farmerTableBody = document.getElementById('farmer-table-body');

  // Paths to your custom images
  const verifiedImage = './images/verified.png';  // Path to your verified icon image
  const unverifiedImage = './images/unverified.jpg';  // Path to your unverified icon image

  farmerTableBody.innerHTML = '';  // Clear existing rows

  farmers.forEach(farmer => {
    // Ensure produceAmount is an array, default to empty array if undefined
    const produceAmount = Array.isArray(farmer.produceAmount) ? farmer.produceAmount : [];

    // Choose the appropriate image based on the governmentVerified status
    const verifiedStatusImage = farmer.governmentVerified ? verifiedImage : unverifiedImage;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td><img src="${farmer.image || './images/farmer-logo.jpg'}" alt="${farmer.name[0] || 'No name'}"></td>
      <td>
        <a href="farmers-details.html?farmerId=${farmer.farmerId || ''}">
          ${farmer.name || 'No name'}
        </a>
      </td>
      <td>${farmer.state || 'No state'}</td>
      <td>${farmer.cropsGrown || 'No crops'}</td>
      <td>${produceAmount.join(', ')} kg</td>
      <td class="verified-status"><img src="${verifiedStatusImage}" alt="Verified Status"></td>
    `;
    farmerTableBody.appendChild(row);
  });
}
  
    // Fetch existing farmers data from JSON
    fetch('./farmers-details.json')
      .then(response => response.json())
      .then(data => {
        farmers = data;  // Initialize farmers with existing data
        fetchFirestoreFarmers();  // Fetch and merge with Firestore data
      })
      .catch(error => console.error('Error fetching the JSON file:', error));
  
  </script>
  
</body>

</html>